                    –ú–Ü–ù–Ü–°–¢–ï–†–°–¢–í–û –û–°–í–Ü–¢–ò –Ü –ù–ê–£–ö–ò –£–ö–†–ê–á–ù–ò
   –•–ê–†–ö–Ü–í–°–¨–ö–ò–ô –ù–ê–¶–Ü–û–ù–ê–õ–¨–ù–ò–ô –£–ù–Ü–í–ï–†–°–ò–¢–ï–¢ –†–ê–î–Ü–û–ï–õ–ï–ö–¢–†–û–ù–Ü–ö–ò



                           –ö–∞—Ñ–µ–¥—Ä–∞ –ü—Ä–æ–≥—Ä–∞–º–Ω–æ—ó —ñ–Ω–∂–µ–Ω–µ—Ä—ñ—ó




                                        –ó–≤—ñ—Ç
                             –∑ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ ‚Ññ3
                     –∑ –¥–∏—Å—Ü–∏–ø–ª—ñ–Ω–∏: ¬´–ê–Ω–∞–ª—ñ–∑ —Ç–∞ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω“ë –∫–æ–¥—É¬ª
–∑ —Ç–µ–º–∏: ¬´–†–æ–∑—Ä–æ–±–∫–∞ –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏ —Ç–∞ —Ñ—É–Ω–∫—Ü—ñ–π –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä—É–≤–∞–Ω–Ω—è —Å–µ—Ä–≤–µ—Ä–Ω–æ—ó —á–∞—Å—Ç–∏–Ω–∏
                                     —Å–∏—Å—Ç–µ–º–∏¬ª




–í–∏–∫–æ–Ω–∞–≤:                                                               –ü–µ—Ä–µ–≤—ñ—Ä–∏–≤:
—Å—Ç. –≥—Ä. –ü–ó–ü–Ü-23-3                                          —Å—Ç. –≤–∏–∫–ª–∞–¥–∞—á –∫–∞—Ç–µ–¥—Ä–∏ –ü–Ü
–û—Å–∏—á–µ–Ω–∫–æ –Ü. –û.                                                      –°–æ–∫–æ—Ä—á—É–∫ –Ü. –ü.




                                   –•–∞—Ä–∫—ñ–≤ ‚Äì 2025
                                                                            2
                               1 –Ü–°–¢–û–†–Ü–Ø –ó–ú–Ü–ù

‚Ññ    –î–∞—Ç–∞    –í–µ—Ä—Å—ñ—è –∑–≤—ñ—Ç—É    –û–ø–∏—Å –∑–º—ñ–Ω —Ç–∞ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å
1 20.12.2025     0.1         –°—Ç–≤–æ—Ä–µ–Ω–æ —Ä–æ–∑–¥—ñ–ª ¬´–ó–∞–≤–¥–∞–Ω–Ω—è¬ª
2 20.12.2025     0.2         –°—Ç–≤–æ—Ä–µ–Ω–æ —Ä–æ–∑–¥—ñ–ª ¬´–û–ø–∏—Å –≤–∏–∫–æ–Ω–∞–Ω–æ—ó —Ä–æ–±–æ—Ç–∏¬ª
3 20.12.2025     1.0         –ó–∞–≤–µ—Ä—à–µ–Ω–æ —Ä–æ–±–æ—Ç—É –Ω–∞–¥ –∑–≤—ñ—Ç–æ–º



                                 2 –ó–ê–í–î–ê–ù–ù–Ø


     –û–∑–Ω–∞–π–æ–º–∏—Ç–∏—Å—è –∑ –ø—Ä–æ—Ü–µ—Å–æ–º —Ä–æ–∑—Ä–æ–±–∫–∏ –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏ —Ç–∞ —Ñ—É–Ω–∫—Ü—ñ–π –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä—É–≤–∞–Ω–Ω—è
—Å–µ—Ä–≤–µ—Ä–Ω–æ—ó —á–∞—Å—Ç–∏–Ω–∏ –ø—Ä–æ–≥—Ä–∞–º–Ω–æ—ó —Å–∏—Å—Ç–µ–º–∏. –û—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–∞–∫—Ç–∏—á–Ω—ñ –Ω–∞–≤–∏—á–∫–∏ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó
–±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏, —Ñ—É–Ω–∫—Ü—ñ–π –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä—É–≤–∞–Ω–Ω—è, —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è UML-–¥—ñ–∞–≥—Ä–∞–º –¥—ñ—è–ª—å–Ω–æ—Å—Ç—ñ —Ç–∞
–≤–∑–∞—î–º–æ–¥—ñ—ó, –∞ —Ç–∞–∫–æ–∂ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ä–æ–±–æ—Ç–∏ —Å–µ—Ä–≤–µ—Ä–Ω–æ—ó —á–∞—Å—Ç–∏–Ω–∏.
                                                                                   3
                           3 –û–ü–ò–° –í–ò–ö–û–ù–ê–ù–û–á –†–û–ë–û–¢–ò

      3.1 –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω—ñ —Ä—ñ—à–µ–Ω–Ω—è –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏

      –ë—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞ —Å–∏—Å—Ç–µ–º–∏ BusOptima —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ –Ω–∞ —Ä—ñ–≤–Ω—ñ —Å–µ—Ä–≤—ñ—Å—ñ–≤ (service
layer) –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ –ø—Ä–∏–Ω—Ü–∏–ø—ñ–≤ —á–∏—Å—Ç–æ—ó –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏. –°–µ—Ä–≤—ñ—Å–Ω–∏–π —Ä—ñ–≤–µ–Ω—å —ñ–Ω–∫–∞–ø—Å—É–ª—é—î
–∞–ª–≥–æ—Ä–∏—Ç–º–∏ –æ–±—Ä–æ–±–∫–∏ –¥–∞–Ω–∏—Ö —Ç–∞ –±—ñ–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞, –∑–∞–±–µ–∑–ø–µ—á—É—é—á–∏ –Ω–µ–∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å –≤—ñ–¥ —Ä—ñ–≤–Ω—è
–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è (handlers) —Ç–∞ —Ä—ñ–≤–Ω—è –¥–æ—Å—Ç—É–ø—É –¥–æ –¥–∞–Ω–∏—Ö (repositories).
      –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤—ñ—Å–Ω–æ–≥–æ —Ä—ñ–≤–Ω—è –≤–∫–ª—é—á–∞—î: AnalyticsService –¥–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É
—Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ —Ä–µ–π—Å—ñ–≤, ForecastService –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è –ø–æ–ø–∏—Ç—É, IoTService –¥–ª—è
–æ–±—Ä–æ–±–∫–∏ –¥–∞–Ω–∏—Ö –≤—ñ–¥ –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤ —Ç–∞ AuthService –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—î—é —Ç–∞
–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏.

      3.2 –ê–ª–≥–æ—Ä–∏—Ç–º–∏ –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏

      3.2.1 –ê–ª–≥–æ—Ä–∏—Ç–º –¥–∏–Ω–∞–º—ñ—á–Ω–æ–≥–æ —Ü—ñ–Ω–æ—É—Ç–≤–æ—Ä–µ–Ω–Ω—è

      IoT-–ø—Ä–∏—Å—Ç—Ä—ñ–π –≤–∏–∫–æ–Ω—É—î –ª–æ–∫–∞–ª—å–Ω–∏–π —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ—ó —Ü—ñ–Ω–∏ –∑–∞
—Ñ–æ—Ä–º—É–ª–æ—é:
                           ùëÉ—Ä–µ–∫ = ùëÉ–±–∞–∑ √ó ùêæ–ø–æ–ø–∏—Ç √ó ùêæ—á–∞—Å √ó ùêæ–¥–µ–Ω—å                  (3.1)

      –¥–µ ùëÉ–±–∞–∑ ‚Äî –±–∞–∑–æ–≤–∞ —Ü—ñ–Ω–∞ –º–∞—Ä—à—Ä—É—Ç—É, ùêæ–ø–æ–ø–∏—Ç , ùêæ—á–∞—Å , ùêæ–¥–µ–Ω—å ‚Äî –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∏
–∫–æ—Ä–∏–≥—É–≤–∞–Ω–Ω—è.
      –ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç –ø–æ–ø–∏—Ç—É ùêæ–ø–æ–ø–∏—Ç –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –ø–æ—Ç–æ—á–Ω–æ—ó –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ—Å—Ç—ñ –∞–≤—Ç–æ–±—É—Å–∞:
                            0.75   —è–∫—â–æ   –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ—Å—Ç—å < 30%
                            0.95   —è–∫—â–æ   30% ‚â§ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ—Å—Ç—å < 60%
                ùêæ–ø–æ–ø–∏—Ç   =                                                      (3.2)
                            1.10   —è–∫—â–æ   60% ‚â§ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ—Å—Ç—å < 85%
                           {1.40   —è–∫—â–æ   –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ—Å—Ç—å ‚â• 85%

      –ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç —á–∞—Å—É ùêæ—á–∞—Å –≤—Ä–∞—Ö–æ–≤—É—î –ø—ñ–∫–æ–≤—ñ –≥–æ–¥–∏–Ω–∏:
                        1.20 —è–∫—â–æ ùë° ‚àà [7 : 00, 9 : 00] ‚à™ [17 : 00, 19 : 00]
               ùêæ—á–∞—Å   = 0.80 —è–∫—â–æ ùë° ‚àà [23 : 00, 6 : 00]                         (3.3)
                       {1.00 –≤ —ñ–Ω—à–∏–π —á–∞—Å
      –ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç –¥–Ω—è ùêæ–¥–µ–Ω—å : 1.15 —É –≤–∏—Ö—ñ–¥–Ω—ñ —Ç–∞ —Å–≤—è—Ç–∫–æ–≤—ñ –¥–Ω—ñ, 1.00 —É –±—É–¥–Ω—ñ.
      –§—ñ–Ω–∞–ª—å–Ω–∞ —Ü—ñ–Ω–∞ –æ–±–º–µ–∂—É—î—Ç—å—Å—è –¥—ñ–∞–ø–∞–∑–æ–Ω–æ–º [0.7 √ó ùëÉ–±–∞–∑ , 1.5 √ó ùëÉ–±–∞–∑ ] —Ç–∞ –æ–∫—Ä—É–≥–ª—é—î—Ç—å—Å—è
–¥–æ 5 –≥—Ä–Ω.
                                                                               4
     3.2.2 –ê–ª–≥–æ—Ä–∏—Ç–º –ø—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è –ø–æ–ø–∏—Ç—É

     –°–µ—Ä–≤–µ—Ä –≤–∏–∫–æ–Ω—É—î –ø—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è –º–µ—Ç–æ–¥–æ–º –∫–æ–≤–∑–Ω–æ–≥–æ —Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º
—Ç—Ä–µ–Ω–¥—É —Ç–∞ —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç—ñ. –ê–ª–≥–æ—Ä–∏—Ç–º –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —ñ—Å—Ç–æ—Ä–∏—á–Ω—ñ –¥–∞–Ω—ñ –∑–∞ –æ—Å—Ç–∞–Ω–Ω—ñ 12 —Ç–∏–∂–Ω—ñ–≤.
     –ë–∞–∑–æ–≤–∏–π –ø—Ä–æ–≥–Ω–æ–∑ (–∫–æ–≤–∑–Ω–µ —Å–µ—Ä–µ–¥–Ω—î –∑–∞ 4 —Ç–∏–∂–Ω—ñ –¥–ª—è —Ç–æ–≥–æ –∂ –¥–Ω—è —Ç–∏–∂–Ω—è):
                                    1 4
                                 ùëã = ‚àë ùëãùë°‚àí7ùëñ                                (3.4)
                                    4 ùëñ=1

     –¥–µ ùëãùë°‚àí7ùëñ ‚Äî –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–∞—Å–∞–∂–∏—Ä—ñ–≤ –∑–∞ ùëñ-–π —Ç–∏–∂–¥–µ–Ω—å —Ç–æ–º—É –≤ —Ç–æ–π —Å–∞–º–∏–π –¥–µ–Ω—å.
     –ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç —Ç—Ä–µ–Ω–¥—É (–ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –æ—Å—Ç–∞–Ω–Ω—ñ—Ö 4 —Ç–∏–∂–Ω—ñ–≤ –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–º–∏ 4):
                                         ‚àë4ùëñ=1 ùëãùë°‚àí7ùëñ
                              ùêæ—Ç—Ä–µ–Ω–¥ =                                      (3.5)
                                         ‚àë8ùëñ=5 ùëãùë°‚àí7ùëñ

     –ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç—ñ ùêæ—Å–µ–∑–æ–Ω : 1.30 –¥–ª—è —Å–≤—è—Ç–∫–æ–≤–∏—Ö –ø–µ—Ä—ñ–æ–¥—ñ–≤ (–ù–æ–≤–∏–π —Ä—ñ–∫,
–í–µ–ª–∏–∫–¥–µ–Ω—å), 1.15 –¥–ª—è –∫–∞–Ω—ñ–∫—É–ª, 1.00 –≤ –∑–≤–∏—á–∞–π–Ω–∏–π —á–∞—Å.
     –§—ñ–Ω–∞–ª—å–Ω–∏–π –ø—Ä–æ–≥–Ω–æ–∑:
                            ÃÇ = ùëã √ó ùêæ—Ç—Ä–µ–Ω–¥ √ó ùêæ—Å–µ–∑–æ–Ω
                            ùëã                                               (3.6)

     –î–æ–≤—ñ—Ä—á–∏–π —ñ–Ω—Ç–µ—Ä–≤–∞–ª —Ä–æ–∑—Ä–∞—Ö–æ–≤—É—î—Ç—å—Å—è –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è:

                                 1 4           2
                            ùúé = ‚àö ‚àë (ùëãùë°‚àí7ùëñ ‚àí ùëã)                             (3.7)
                                 4 ùëñ=1

                                 ÃÇ ‚àí 1.96ùúé, ùëã
                        CI95% = [ùëã          ÃÇ + 1.96ùúé]                      (3.8)
                                                             ÃÇ > 0.95 √ó
     –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –≥–µ–Ω–µ—Ä—É—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ: ¬´–¥–æ–¥–∞—Ç–∏ —Ä–µ–π—Å¬ª –ø—Ä–∏ ùëã
                               ÃÇ < 0.25 √ó capacity.
capacity, ¬´—Å–∫–∞—Å—É–≤–∞—Ç–∏ —Ä–µ–π—Å¬ª –ø—Ä–∏ ùëã

     3.2.3 –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ

     –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è —â–æ–¥–µ–Ω–Ω–æ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—Ö —Ä–µ–π—Å—ñ–≤.
     –í–∏—Ä—É—á–∫–∞:
                                          ùëõ
                                   ùëÖ = ‚àë ùëÉùëñ                                 (3.9)
                                         ùëñ=1

     –¥–µ ùëÉùëñ ‚Äî —Ü—ñ–Ω–∞ –∫–≤–∏—Ç–∫–∞ ùëñ-–≥–æ –ø–∞—Å–∞–∂–∏—Ä–∞ (–∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –¥–∏–Ω–∞–º—ñ—á–Ω–æ–≥–æ
—Ü—ñ–Ω–æ—É—Ç–≤–æ—Ä–µ–Ω–Ω—è).
     –í–∏—Ç—Ä–∞—Ç–∏:
                                                                                 5
                           ùê∂ = ùê∂–ø–∞–ª–∏–≤–æ + ùê∂–≤–æ–¥—ñ–π + ùê∂—ñ–Ω—à—ñ                      (3.10)
                                             ùêπ
                           ùê∂–ø–∞–ª–∏–≤–æ = ùê∑ √ó        √ó ùëÉ–ø–∞–ª–∏–≤–æ                    (3.11)
                                            100
      –¥–µ ùê∑ ‚Äî –≤—ñ–¥—Å—Ç–∞–Ω—å –º–∞—Ä—à—Ä—É—Ç—É (–∫–º), ùêπ ‚Äî –≤–∏—Ç—Ä–∞—Ç–∞ –ø–∞–ª–∏–≤–∞ (–ª/100–∫–º), ùëÉ–ø–∞–ª–∏–≤–æ ‚Äî
—Ü—ñ–Ω–∞ –ø–∞–ª–∏–≤–∞ (–≥—Ä–Ω/–ª).
      –ü—Ä–∏–±—É—Ç–æ–∫ —Ç–∞ —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω—ñ—Å—Ç—å:
                                   Profit = ùëÖ ‚àí ùê∂                            (3.12)
                                            Profit
                          Profitability =          √ó 100%                    (3.13)
                                              ùê∂
      –†–µ–π—Å–∏     –∫–∞—Ç–µ–≥–æ—Ä–∏–∑—É—é—Ç—å—Å—è:       ¬´–∑–±–∏—Ç–∫–æ–≤–∏–π¬ª      –ø—Ä–∏   —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ     <
0%,    ¬´–Ω–∏–∑—å–∫–æ—Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–∏–π¬ª      –ø—Ä–∏     0-20%,      ¬´–Ω–æ—Ä–º–∞–ª—å–Ω–∏–π¬ª   –ø—Ä–∏    20-50%,
¬´–≤–∏—Å–æ–∫–æ—Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–∏–π¬ª –ø—Ä–∏ > 50%.

      3.3 UML –¥—ñ–∞–≥—Ä–∞–º–∞ –¥—ñ—è–ª—å–Ω–æ—Å—Ç—ñ

      –î—ñ–∞–≥—Ä–∞–º–∞ –¥—ñ—è–ª—å–Ω–æ—Å—Ç—ñ –æ–ø–∏—Å—É—î –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å –¥—ñ–π –ø—Ä–∏ –æ–±—Ä–æ–±—Ü—ñ –∑–∞–ø–∏—Ç—É –Ω–∞
—Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ —Ä–µ–π—Å—É. –ü—Ä–æ—Ü–µ—Å –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –∑ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—É –≤—ñ–¥
–∫–ª—ñ—î–Ω—Ç–∞, –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø—É. –î–∞–ª—ñ —Å–∏—Å—Ç–µ–º–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î
–¥–∞–Ω—ñ —Ä–µ–π—Å—É, –º–∞—Ä—à—Ä—É—Ç—É —Ç–∞ –∞–≤—Ç–æ–±—É—Å–∞ –∑ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö, –≤–∏–∫–æ–Ω—É—î —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –≤–∏—Ç—Ä–∞—Ç (–ø–∞–ª–∏–≤–æ,
–≤–æ–¥—ñ–π, —ñ–Ω—à—ñ), –æ–±—á–∏—Å–ª—é—î –≤–∏—Ä—É—á–∫—É –Ω–∞ –æ—Å–Ω–æ–≤—ñ –ø–æ–¥—ñ–π –ø–∞—Å–∞–∂–∏—Ä—ñ–≤ —Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ–π —Ü—ñ–Ω,
—Ä–æ–∑—Ä–∞—Ö–æ–≤—É—î –ø—Ä–∏–±—É—Ç–æ–∫ —Ç–∞ —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω—ñ—Å—Ç—å, –∑–±–µ—Ä—ñ–≥–∞—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –≤ —Ç–∞–±–ª–∏—Ü—é trip_analytics
—Ç–∞ –ø–æ–≤–µ—Ä—Ç–∞—î –≤—ñ–¥–ø–æ–≤—ñ–¥—å –∫–ª—ñ—î–Ω—Ç—É.
                                                                                 6




        –†–∏—Å—É–Ω–æ–∫ 3.1 ‚Äì UML –¥—ñ–∞–≥—Ä–∞–º–∞ –¥—ñ—è–ª—å–Ω–æ—Å—Ç—ñ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ

     3.4 UML –¥—ñ–∞–≥—Ä–∞–º–∞ –≤–∑–∞—î–º–æ–¥—ñ—ó

     –î—ñ–∞–≥—Ä–∞–º–∞     –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ—Å—Ç—ñ    –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î     –æ–±–º—ñ–Ω    –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º–∏      –º—ñ–∂
–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ —Å–∏—Å—Ç–µ–º–∏ –ø—Ä–∏ –ø—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—ñ –ø–æ–ø–∏—Ç—É. –î–∏—Å–ø–µ—Ç—á–µ—Ä –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î GET-–∑–∞–ø–∏—Ç
–Ω–∞ /api/analytics/forecast –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ route_id —Ç–∞ date. AnalyticsHandler –≤–∞–ª—ñ–¥—É—î
–ø–∞—Ä–∞–º–µ—Ç—Ä–∏ —Ç–∞ –≤–∏–∫–ª–∏–∫–∞—î ForecastService.ForecastDemand. –°–µ—Ä–≤—ñ—Å –æ—Ç—Ä–∏–º—É—î —ñ—Å—Ç–æ—Ä–∏—á–Ω—ñ
–¥–∞–Ω—ñ —á–µ—Ä–µ–∑ AnalyticsRepository.GetHistoricalPassengers, –æ–±—á–∏—Å–ª—é—î –∫–æ–≤–∑–Ω–µ —Å–µ—Ä–µ–¥–Ω—î –∑–∞
4 —Ç–∏–∂–Ω—ñ, —Ä–æ–∑—Ä–∞—Ö–æ–≤—É—î –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∏ —Ç—Ä–µ–Ω–¥—É —Ç–∞ —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç—ñ, —Ñ–æ—Ä–º—É—î –ø—Ä–æ–≥–Ω–æ–∑ –∑ –¥–æ–≤—ñ—Ä—á–∏–º
                                                                             7
—ñ–Ω—Ç–µ—Ä–≤–∞–ª–æ–º. –ü—ñ—Å–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø—Ä–æ–≥–Ω–æ–∑—É –≤ –±–∞–∑—É –¥–∞–Ω–∏—Ö –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –≤—ñ–¥–ø–æ–≤—ñ–¥—å –∑
—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è–º–∏.




        –†–∏—Å—É–Ω–æ–∫ 3.2 ‚Äì UML –¥—ñ–∞–≥—Ä–∞–º–∞ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ—Å—Ç—ñ –ø—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è –ø–æ–ø–∏—Ç—É

     3.5 –§—É–Ω–∫—Ü—ñ—ó –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä—É–≤–∞–Ω–Ω—è

     3.5.1 –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏

     –°–∏—Å—Ç–µ–º–∞ –ø—ñ–¥—Ç—Ä–∏–º—É—î –ø–æ–≤–Ω–∏–π —Ü–∏–∫–ª —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏: —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è,
–ø–µ—Ä–µ–≥–ª—è–¥, –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –¥–µ–∞–∫—Ç–∏–≤–∞—Ü—ñ—è –æ–±–ª—ñ–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤. AuthService —Ä–µ–∞–ª—ñ–∑—É—î
–º–µ—Ç–æ–¥–∏ CreateUser, UpdateUser, UpdateUserRole —Ç–∞ GetUsers. –ü—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ
–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –ø–∞—Ä–æ–ª—å —Ö–µ—à—É—î—Ç—å—Å—è –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º bcrypt –∑ cost factor 10. –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Ä–æ–ª—ñ
                                                                                           8
–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–º—ñ–Ω—é—î –Ω–∞–±—ñ—Ä –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –¥–æ–∑–≤–æ–ª—ñ–≤ —á–µ—Ä–µ–∑ –∑–≤‚Äô—è–∑–∫–æ–≤—É —Ç–∞–±–ª–∏—Ü—é
role_permissions.
      AdminHandler –Ω–∞–¥–∞—î REST API –¥–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä—É–≤–∞–Ω–Ω—è: GET /api/admin/users
–ø–æ–≤–µ—Ä—Ç–∞—î —Å–ø–∏—Å–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∑ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é –ø—Ä–æ —Ä–æ–ª—ñ, POST /api/admin/users
—Å—Ç–≤–æ—Ä—é—î –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, PUT /api/admin/users/{id} –æ–Ω–æ–≤–ª—é—î –¥–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞,
PUT /api/admin/users/{id}/role –∑–º—ñ–Ω—é—î —Ä–æ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.

      3.5.2 –°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π —Ç–∞ –¥–æ–∑–≤–æ–ª—ñ–≤ (RBAC)

      –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ Role-Based Access Control. –°–∏—Å—Ç–µ–º–∞ –≤–∫–ª—é—á–∞—î
—Ç—Ä–∏ —Ä–æ–ª—ñ: dispatcher (–¥–∏—Å–ø–µ—Ç—á–µ—Ä), admin (–±—ñ–∑–Ω–µ—Å-–∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä), tech_admin
(—Ç–µ—Ö–Ω—ñ—á–Ω–∏–π –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä). –ö–æ–∂–Ω–∞ —Ä–æ–ª—å –º–∞—î –Ω–∞–±—ñ—Ä –¥–æ–∑–≤–æ–ª—ñ–≤: routes:read, routes:write,
buses:read, buses:write, users:read, users:write, analytics:read, reports:export, audit:read,
system:backup.

–¢–∞–±–ª–∏—Ü—è 3.1 ‚Äì –†–æ–ª—ñ —Ç–∞ –¥–æ–∑–≤–æ–ª–∏ —Å–∏—Å—Ç–µ–º–∏
–†–æ–ª—å          –î–æ–∑–≤–æ–ª–∏                                –û–ø–∏—Å
dispatcher    routes:read,               buses:read, –ü–µ—Ä–µ–≥–ª—è–¥ —Ç–∞ –∑–≤—ñ—Ç–∏
              analytics:read, reports:export
admin         routes:*,      buses:*,      users:*, –ü–æ–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø –¥–æ –±—ñ–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü—ñ–π
              analytics:read,        reports:export,
           audit:read
tech_admin system:backup, audit:read                   –°–∏—Å—Ç–µ–º–Ω–µ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä—É–≤–∞–Ω–Ω—è

      Middleware RequirePermission –ø–µ—Ä–µ–≤—ñ—Ä—è—î –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ–≥–æ –¥–æ–∑–≤–æ–ª—É –ø–µ—Ä–µ–¥
–≤–∏–∫–æ–Ω–∞–Ω–Ω—è–º –æ–ø–µ—Ä–∞—Ü—ñ—ó. –î–æ–∑–≤–æ–ª–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ JWT-—Ç–æ–∫–µ–Ω—ñ —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å—Å—è –±–µ–∑
–¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤ –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö.
                                                                                 9
          3.5.3 API –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä—É–≤–∞–Ω–Ω—è

–¢–∞–±–ª–∏—Ü—è 3.2 ‚Äì –ï–Ω–¥–ø–æ—ó–Ω—Ç–∏ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä—É–≤–∞–Ω–Ω—è
–ú–µ—Ç–æ–¥       –ï–Ω–¥–ø–æ—ñ–Ω—Ç                                 –†–æ–ª—å    –û–ø–∏—Å
GET         /api/admin/users                         admin   –°–ø–∏—Å–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
POST        /api/admin/users                         admin   –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
PUT         /api/admin/users/{id}                    admin   –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
PUT         /api/admin/users/{id}/role               admin   –ó–º—ñ–Ω–∞ —Ä–æ–ª—ñ
GET         /api/admin/settings                      admin   –°–∏—Å—Ç–µ–º–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏
PUT         /api/admin/settings                      admin   –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤
GET         /api/admin/audit-logs                    admin   –ñ—É—Ä–Ω–∞–ª –∞—É–¥–∏—Ç—É

          POST /api/admin/users - —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.
          –ó–∞–ø–∏—Ç:

1    {
2          "email": "new.user@busoptima.ua",
3          "password": "securePassword123",
4          "full_name": "–ù–æ–≤–∏–π –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á",
5          "role_id": 1
6    }


          –í—ñ–¥–ø–æ–≤—ñ–¥—å (201 Created):

 1 {
 2          "id": 5,
 3          "email": "new.user@busoptima.ua",
 4          "full_name": "–ù–æ–≤–∏–π –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á",
 5          "role_id": 1,
 6          "role": {
 7              "id": 1,
 8              "name": "dispatcher",
 9              "description": "–î–∏—Å–ø–µ—Ç—á–µ—Ä - –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ç–∞ –∑–≤—ñ—Ç–∏"
10          },
11          "is_active": true,
12          "created_at": "2025-12-21T10:30:00Z"
13 }


          PUT /api/admin/settings - –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º–Ω–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤.
          –ó–∞–ø–∏—Ç:

    1 {
    2       "fuel_price_per_liter": 52.50,
    3       "peak_hours_coefficient": 1.30,
                                                                            10

 4       "weekend_coefficient": 1.20,
 5       "high_demand_threshold": 85,
 6       "low_demand_threshold": 30,
 7       "price_min_coefficient": 0.65,
 8       "price_max_coefficient": 1.60,
 9       "seasonal_coefficients": {
10           "new_year": 1.35,
11           "summer": 1.20,
12           "regular": 1.00
13       }
14 }


       –í—ñ–¥–ø–æ–≤—ñ–¥—å (200 OK):

 1 {
 2       "message": "System settings updated successfully",
 3       "updated_at": "2025-12-21T11:45:00Z",
 4       "settings": {
 5           "fuel_price_per_liter": 52.50,
 6           "peak_hours_coefficient": 1.30,
 7           "weekend_coefficient": 1.20,
 8           "high_demand_threshold": 85,
 9           "low_demand_threshold": 30,
10           "price_min_coefficient": 0.65,
11           "price_max_coefficient": 1.60,
12           "seasonal_coefficients": {
13               "new_year": 1.35,
14               "summer": 1.20,
15               "regular": 1.00
16           }
17       }
18 }


       GET /api/admin/settings - –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–æ—Ç–æ—á–Ω–∏—Ö —Å–∏—Å—Ç–µ–º–Ω–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤.
       –í—ñ–¥–ø–æ–≤—ñ–¥—å (200 OK):

 1 {
 2       "fuel_price_per_liter": 50.00,
 3       "peak_hours_coefficient": 1.20,
 4       "weekend_coefficient": 1.15,
 5       "high_demand_threshold": 85,
 6       "low_demand_threshold": 30,
 7       "price_min_coefficient": 0.70,
 8       "price_max_coefficient": 1.50,
 9       "seasonal_coefficients": {
10           "new_year": 1.30,
11           "summer": 1.15,
12           "regular": 1.00
13       },
14       "last_updated": "2025-12-20T14:30:00Z",
15       "updated_by": {
16           "id": 2,
                                                                                       11

17                 "email": "admin@busoptima.ua",
18                 "full_name": "–°–∏—Å—Ç–µ–º–Ω–∏–π –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä"
19           }
20   }


         GET /api/admin/audit-logs - –∂—É—Ä–Ω–∞–ª –¥—ñ–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤.
         –ü–∞—Ä–∞–º–µ—Ç—Ä–∏: user_id, action, entity_type, date_from, date_to, page, limit
         –í—ñ–¥–ø–æ–≤—ñ–¥—å (200 OK):

 1 {
 2           "logs": [{
 3               "id": 1234,
 4               "user": {
 5                   "id": 2,
 6                   "email": "admin@busoptima.ua",
 7                   "full_name": "–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä"
 8               },
 9               "action": "UPDATE",
10               "entity_type": "routes",
11               "entity_id": 5,
12               "old_values": {"base_price": 180.00},
13               "new_values": {"base_price": 200.00},
14               "ip_address": "192.168.1.100",
15               "created_at": "2025-12-21T09:15:00Z"
16           }],
17           "total": 1234,
18           "page": 1,
19           "limit": 20
20 }


         3.5.4 –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º–Ω–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤

         –°–∏—Å—Ç–µ–º–∞ –ø—ñ–¥—Ç—Ä–∏–º—É—î —Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–µ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–ª—é—á–æ–≤–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏,
—â–æ –≤–ø–ª–∏–≤–∞—é—Ç—å –Ω–∞ –∞–ª–≥–æ—Ä–∏—Ç–º–∏ –¥–∏–Ω–∞–º—ñ—á–Ω–æ–≥–æ —Ü—ñ–Ω–æ—É—Ç–≤–æ—Ä–µ–Ω–Ω—è, —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –≤–∏—Ç—Ä–∞—Ç —Ç–∞
–ø—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è. –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ —Ü—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É
—Å–∏—Å—Ç–µ–º–∏ –∞–±–æ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –∫–æ–¥—É.
         –°–∏—Å—Ç–µ–º–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ —Ç–∞–±–ª–∏—Ü—ñ system_settings –∑ –ø–æ–ª—è–º–∏
parameter_name, parameter_value (JSONB), updated_at —Ç–∞ updated_by. –ó–º—ñ–Ω–∏
–ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ñ—ñ–∫—Å—É—é—Ç—å—Å—è –≤ –∂—É—Ä–Ω–∞–ª—ñ –∞—É–¥–∏—Ç—É.
         –ö–ª—é—á–æ–≤—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –≤–∫–ª—é—á–∞—é—Ç—å:
         ‚Äì       fuel_price_per_liter: –≥–ª–æ–±–∞–ª—å–Ω–∞ —Ü—ñ–Ω–∞ –ø–∞–ª–∏–≤–∞ –¥–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –≤–∏—Ç—Ä–∞—Ç —Ä–µ–π—Å—ñ–≤
         ‚Äì       peak_hours_coefficient: –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è —Ü—ñ–Ω–∏ –≤ –ø—ñ–∫–æ–≤—ñ –≥–æ–¥–∏–Ω–∏ (7-9,
                 17-19)
                                                                                   12
      ‚Äì   weekend_coefficient: –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç –¥–ª—è –≤–∏—Ö—ñ–¥–Ω–∏—Ö —Ç–∞ —Å–≤—è—Ç–∫–æ–≤–∏—Ö –¥–Ω—ñ–≤
      ‚Äì   high_demand_threshold: –ø–æ—Ä—ñ–≥ –≤–∏—Å–æ–∫–æ–≥–æ –ø–æ–ø–∏—Ç—É (% –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ—Å—Ç—ñ) –¥–ª—è
          –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∞ 1.40
      ‚Äì   low_demand_threshold:    –ø–æ—Ä—ñ–≥   –Ω–∏–∑—å–∫–æ–≥–æ   –ø–æ–ø–∏—Ç—É     –¥–ª—è    –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è
          –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∞ 0.75
      ‚Äì   price_min_coefficient   —Ç–∞    price_max_coefficient:   –º–µ–∂—ñ      –¥—ñ–∞–ø–∞–∑–æ–Ω—É
          –¥–∏–Ω–∞–º—ñ—á–Ω–æ–≥–æ —Ü—ñ–Ω–æ—É—Ç–≤–æ—Ä–µ–Ω–Ω—è
      ‚Äì   seasonal_coefficients: –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∏ —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç—ñ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –ø–µ—Ä—ñ–æ–¥—ñ–≤ —Ä–æ–∫—É
     –ü—Ä–∏ –∑–º—ñ–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ —Å–∏—Å—Ç–µ–º–∞ –≤–∞–ª—ñ–¥—É—î –∑–Ω–∞—á–µ–Ω–Ω—è (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∏
–ø–æ–≤–∏–Ω–Ω—ñ –±—É—Ç–∏ –≤ –¥—ñ–∞–ø–∞–∑–æ–Ω—ñ 0.1-5.0, –ø–æ—Ä–æ–≥–∏ –ø–æ–ø–∏—Ç—É - –≤—ñ–¥ 0 –¥–æ 100%).
–û–Ω–æ–≤–ª–µ–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –Ω–µ–≥–∞–π–Ω–æ –∑–∞—Å—Ç–æ—Å–æ–≤—É—é—Ç—å—Å—è –¥–æ –Ω–æ–≤–∏—Ö —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—ñ–≤ –±–µ–∑ –ø–æ—Ç—Ä–µ–±–∏
–ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–µ—Ä–≤—ñ—Å—ñ–≤.

     3.5.5 –ñ—É—Ä–Ω–∞–ª –∞—É–¥–∏—Ç—É

     –°–∏—Å—Ç–µ–º–∞ —Ñ—ñ–∫—Å—É—î –≤—Å—ñ –º–æ–¥–∏—Ñ—ñ–∫—É—é—á—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó (POST, PUT, DELETE) —É —Ç–∞–±–ª–∏—Ü—ñ
audit_logs. Middleware AuditLog –ø–µ—Ä–µ—Ö–æ–ø–ª—é—î –∑–∞–ø–∏—Ç–∏ —Ç–∞ –∑–±–µ—Ä—ñ–≥–∞—î: user_id –≤–∏–∫–æ–Ω–∞–≤—Ü—è,
—Ç–∏–ø –¥—ñ—ó (CREATE/UPDATE/DELETE), —Ç–∏–ø —Ç–∞ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä —Å—É—Ç–Ω–æ—Å—Ç—ñ, —Å—Ç–∞—Ä—ñ —Ç–∞ –Ω–æ–≤—ñ
–∑–Ω–∞—á–µ–Ω–Ω—è —É —Ñ–æ—Ä–º–∞—Ç—ñ JSONB, IP-–∞–¥—Ä–µ—Å—É –∫–ª—ñ—î–Ω—Ç–∞, —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è.
     GET /api/admin/audit-logs –ø–æ–≤–µ—Ä—Ç–∞—î –∑–∞–ø–∏—Å–∏ –∂—É—Ä–Ω–∞–ª—É –∑ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—é —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó
–∑–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º, —Ç–∏–ø–æ–º –¥—ñ—ó, —Å—É—Ç–Ω—ñ—Å—Ç—é —Ç–∞ –ø–µ—Ä—ñ–æ–¥–æ–º —á–∞—Å—É. –ü—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è –ø–∞–≥—ñ–Ω–∞—Ü—ñ—è –¥–ª—è
–µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ –∑ –≤–µ–ª–∏–∫–∏–º–∏ –æ–±—Å—è–≥–∞–º–∏ –¥–∞–Ω–∏—Ö.

     3.5.6 –†–µ–∑–µ—Ä–≤–Ω–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è

     –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä –º–∞—î –¥–æ—Å—Ç—É–ø –¥–æ —Ñ—É–Ω–∫—Ü—ñ—ó —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –±–∞–∑–∏
–¥–∞–Ω–∏—Ö —á–µ—Ä–µ–∑ POST /api/admin/backup. –û–ø–µ—Ä–∞—Ü—ñ—è –≤–∏–∫–æ–Ω—É—î pg_dump –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –¥–ª—è
—Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–æ–≤–Ω–æ—ó –∫–æ–ø—ñ—ó —Å—Ö–µ–º–∏ —Ç–∞ –¥–∞–Ω–∏—Ö. –†–µ–∑–µ—Ä–≤–Ω—ñ –∫–æ–ø—ñ—ó –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –∑ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–º
—ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–æ–º, —â–æ –≤–∫–ª—é—á–∞—î –¥–∞—Ç—É —Ç–∞ —á–∞—Å —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è.

     3.6 API –µ–Ω–¥–ø–æ—ó–Ω—Ç–∏ –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏

     –°–µ—Ä–≤–µ—Ä–Ω–∞ —á–∞—Å—Ç–∏–Ω–∞ –Ω–∞–¥–∞—î REST API –¥–ª—è –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏ —Å–∏—Å—Ç–µ–º–∏. –ù–æ–≤—ñ –µ–Ω–¥–ø–æ—ó–Ω—Ç–∏
Lab3 –≤–∫–ª—é—á–∞—é—Ç—å –∞–Ω–∞–ª—ñ—Ç–∏–∫—É, –ø—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è —Ç–∞ –¥–∏–Ω–∞–º—ñ—á–Ω–µ —Ü—ñ–Ω–æ—É—Ç–≤–æ—Ä–µ–Ω–Ω—è.
                                                                                  13
       3.6.1 –ú–æ–¥—É–ª—å –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏

–¢–∞–±–ª–∏—Ü—è 3.3 ‚Äì –ï–Ω–¥–ø–æ—ó–Ω—Ç–∏ –º–æ–¥—É–ª—è –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏
–ú–µ—Ç–æ–¥     –ï–Ω–¥–ø–æ—ñ–Ω—Ç                                         –û–ø–∏—Å
GET       /api/analytics/dashboard                         –ü–∞–Ω–µ–ª—å –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É
GET       /api/analytics/forecast                          –ü—Ä–æ–≥–Ω–æ–∑ –ø–æ–ø–∏—Ç—É
GET       /api/analytics/forecasts                         –ó–±–µ—Ä–µ–∂–µ–Ω—ñ –ø—Ä–æ–≥–Ω–æ–∑–∏
GET       /api/analytics/profitability                     –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞ —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ

       GET /api/analytics/dashboard - –ø–∞–Ω–µ–ª—å –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –∑ –∞–≥—Ä–µ–≥–æ–≤–∞–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏.
       –í—ñ–¥–ø–æ–≤—ñ–¥—å (200 OK):

 1 {
 2       "active_trips": 12,
 3       "total_passengers": 450,
 4       "total_revenue": 25600.00,
 5       "total_profit": 8200.00,
 6       "avg_occupancy": 68.5,
 7       "avg_profitability": 47.3,
 8       "profitable_trips": 10,
 9       "unprofitable_trips": 2,
10       "trips_by_category": {
11           "high_profit": 4,
12           "normal": 6,
13           "low_profit": 1,
14           "unprofitable": 1
15       }
16 }


       GET /api/analytics/forecast - –ø—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è –ø–æ–ø–∏—Ç—É –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É –¥–∞—Ç—É.
       –ü–∞—Ä–∞–º–µ—Ç—Ä–∏: route_id (required), date (optional, default: tomorrow)
       –í—ñ–¥–ø–æ–≤—ñ–¥—å (200 OK):

 1 {
 2       "route": {
 3           "id": 1,
 4           "origin_city": "–•–∞—Ä–∫—ñ–≤",
 5           "destination_city": "–ö–∏—ó–≤"
 6       },
 7       "algorithm": "moving_average_4w_trend_seasonality",
 8       "forecasts": [{
 9           "date": "2025-12-21",
10           "day_of_week": "Saturday",
11           "predicted_passengers": 38,
12           "confidence_interval": {"lower": 32, "upper": 44},
13           "trend_coefficient": 1.05,
14           "season_coefficient": 1.15,
                                                                                14

15           "recommendation": "normal",
16           "recommendation_details": "–û—á—ñ–∫—É—î—Ç—å—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞
     –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ—Å—Ç—å"
17       }]
18   }


         3.6.2 –ú–æ–¥—É–ª—å –¥–∏–Ω–∞–º—ñ—á–Ω–æ–≥–æ —Ü—ñ–Ω–æ—É—Ç–≤–æ—Ä–µ–Ω–Ω—è

–¢–∞–±–ª–∏—Ü—è 3.4 ‚Äì –ï–Ω–¥–ø–æ—ó–Ω—Ç–∏ –º–æ–¥—É–ª—è —Ü—ñ–Ω–æ—É—Ç–≤–æ—Ä–µ–Ω–Ω—è
–ú–µ—Ç–æ–¥ –ï–Ω–¥–ø–æ—ñ–Ω—Ç                                      –û–ø–∏—Å
POST /api/pricing/calculate                         –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ—ó —Ü—ñ–Ω–∏

         POST /api/pricing/calculate - —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ—ó —Ü—ñ–Ω–∏.
         –ó–∞–ø–∏—Ç:

1    {
2         "base_price": 200.00,
3         "current_passengers": 35,
4         "capacity": 50,
5         "departure_time": "2025-12-21T08:00:00Z"
6    }


         –í—ñ–¥–ø–æ–≤—ñ–¥—å (200 OK):

 1 {
 2         "base_price": 200.00,
 3         "recommended_price": 230.00,
 4         "occupancy_rate": 70.0,
 5         "demand_coefficient": 1.10,
 6         "time_coefficient": 1.20,
 7         "day_coefficient": 1.15,
 8         "price_change": 30.00,
 9         "price_change_percent": 15.0,
10         "category": "high",
11         "recommendation": "–ü—ñ–¥–≤–∏—â–µ–Ω–Ω—è —Ü—ñ–Ω–∏ —á–µ—Ä–µ–∑ –≤–∏—Å–æ–∫—É –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ—Å—Ç—å"
12 }


         3.6.3 –ú–æ–¥—É–ª—å –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏ —Ä–µ–π—Å—ñ–≤

–¢–∞–±–ª–∏—Ü—è 3.5 ‚Äì –ï–Ω–¥–ø–æ—ó–Ω—Ç–∏ –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏ —Ä–µ–π—Å—ñ–≤
–ú–µ—Ç–æ–¥ –ï–Ω–¥–ø–æ—ñ–Ω—Ç                                               –û–ø–∏—Å
GET /api/trips/{id}/analytics                                –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞ —Ä–µ–π—Å—É
POST /api/trips/{id}/analytics/calculate                     –ü–µ—Ä–µ—Ä–∞—Ö—É–Ω–æ–∫ –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏
                                                                                    15
       GET /api/trips/42/analytics - –∞–Ω–∞–ª—ñ—Ç–∏–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ä–µ–π—Å—É.
       –í—ñ–¥–ø–æ–≤—ñ–¥—å (200 OK):

 1 {
 2       "id": 15,
 3       "trip_id": 42,
 4       "total_passengers": 35,
 5       "max_passengers": 42,
 6       "avg_occupancy_rate": 70.0,
 7       "revenue": 1800.00,
 8       "fuel_cost": 450.00,
 9       "driver_cost": 800.00,
10       "other_costs": 150.00,
11       "profit": 400.00,
12       "profitability_percent": 28.57,
13       "calculated_at": "2025-12-21T18:30:00Z"
14 }


       3.7 –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏

       3.7.1 –°–µ—Ä–≤—ñ—Å –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏

       AnalyticsService —Ä–µ–∞–ª—ñ–∑—É—î –º–µ—Ç–æ–¥–∏ GetDashboard —Ç–∞ GetProfitability. –ú–µ—Ç–æ–¥
GetDashboard –∞–≥—Ä–µ–≥—É—î –¥–∞–Ω—ñ –¥–ª—è –ø–∞–Ω–µ–ª—ñ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É: –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∏—Ö —Ä–µ–π—Å—ñ–≤,
–∑–∞–≥–∞–ª—å–Ω—É –≤–∏—Ä—É—á–∫—É, —Å–µ—Ä–µ–¥–Ω—é –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ—Å—Ç—å —Ç–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø—Ä–∏–±—É—Ç–∫–æ–≤–∏—Ö —Ä–µ–π—Å—ñ–≤. –ú–µ—Ç–æ–¥
GetProfitability –ø–æ–≤–µ—Ä—Ç–∞—î –∞–Ω–∞–ª—ñ—Ç–∏–∫—É —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ –∑–∞ –º–∞—Ä—à—Ä—É—Ç–æ–º —Ç–∞ –ø–µ—Ä—ñ–æ–¥–æ–º.
       AnalyticsRepository –≤–∏–∫–æ–Ω—É—î —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏ —Ä–µ–π—Å—É —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥
CalculateTripAnalytics. –ó–∞–ø–∏—Ç –æ–±‚Äô—î–¥–Ω—É—î –¥–∞–Ω—ñ –∑ —Ç–∞–±–ª–∏—Ü—å trips, routes, buses,
passenger_events —Ç–∞ price_recommendations. –†–æ–∑—Ä–∞—Ö–æ–≤–∞–Ω—ñ –ø–æ–∫–∞–∑–Ω–∏–∫–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤
trip_analytics –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º ON CONFLICT DO UPDATE –¥–ª—è —ñ–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—ñ.

       3.7.2 –°–µ—Ä–≤—ñ—Å –ø—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è

       ForecastService   —Ä–µ–∞–ª—ñ–∑—É—î     –º–µ—Ç–æ–¥   ForecastDemand    –¥–ª—è      –ø—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è
–ø–æ–ø–∏—Ç—É    –Ω–∞    –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É    –¥–∞—Ç—É.    –ê–ª–≥–æ—Ä–∏—Ç–º   –æ—Ç—Ä–∏–º—É—î     —ñ—Å—Ç–æ—Ä–∏—á–Ω—ñ     –¥–∞–Ω—ñ   —á–µ—Ä–µ–∑
AnalyticsRepository.GetHistoricalPassengers, –æ–±—á–∏—Å–ª—é—î –∫–æ–≤–∑–Ω–µ —Å–µ—Ä–µ–¥–Ω—î, –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∏
—Ç—Ä–µ–Ω–¥—É —Ç–∞ —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç—ñ, —Ñ–æ—Ä–º—É—î –ø—Ä–æ–≥–Ω–æ–∑ –∑ –¥–æ–≤—ñ—Ä—á–∏–º —ñ–Ω—Ç–µ—Ä–≤–∞–ª–æ–º.
       –ú–µ—Ç–æ–¥ GetForecasts –ø–æ–≤–µ—Ä—Ç–∞—î –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –ø—Ä–æ–≥–Ω–æ–∑–∏ –¥–ª—è –º–∞—Ä—à—Ä—É—Ç—É –∑–∞ –ø–µ—Ä—ñ–æ–¥.
–ü—Ä–æ–≥–Ω–æ–∑–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ —Ç–∞–±–ª–∏—Ü—ñ demand_forecasts –∑ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–º –æ–±–º–µ–∂–µ–Ω–Ω—è–º –Ω–∞
–∫–æ–º–±—ñ–Ω–∞—Ü—ñ—é route_id —Ç–∞ forecast_date.
                                                                                 16
     3.7.3 –°–µ—Ä–≤—ñ—Å –¥–∏–Ω–∞–º—ñ—á–Ω–æ–≥–æ —Ü—ñ–Ω–æ—É—Ç–≤–æ—Ä–µ–Ω–Ω—è

     PricingService —Ä–µ–∞–ª—ñ–∑—É—î –∞–ª–≥–æ—Ä–∏—Ç–º –¥–∏–Ω–∞–º—ñ—á–Ω–æ–≥–æ —Ü—ñ–Ω–æ—É—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑ —Ç—Ä—å–æ–º–∞
–∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∞–º–∏ –∫–æ—Ä–∏–≥—É–≤–∞–Ω–Ω—è. –ú–µ—Ç–æ–¥ CalculatePrice –ø—Ä–∏–π–º–∞—î –±–∞–∑–æ–≤—É —Ü—ñ–Ω—É –º–∞—Ä—à—Ä—É—Ç—É,
–ø–æ—Ç–æ—á–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–∞—Å–∞–∂–∏—Ä—ñ–≤, –º—ñ—Å—Ç–∫—ñ—Å—Ç—å –∞–≤—Ç–æ–±—É—Å–∞ —Ç–∞ —á–∞—Å –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è.
     –û–±—á–∏—Å–ª—é—î—Ç—å—Å—è –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç –ø–æ–ø–∏—Ç—É –Ω–∞ –æ—Å–Ω–æ–≤—ñ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ—Å—Ç—ñ (0.75-1.40),
–∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç —á–∞—Å—É –¥–ª—è –ø—ñ–∫–æ–≤–∏—Ö –≥–æ–¥–∏–Ω (0.80-1.20) —Ç–∞ –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç –¥–Ω—è –¥–ª—è –≤–∏—Ö—ñ–¥–Ω–∏—Ö
(1.00-1.15). –§—ñ–Ω–∞–ª—å–Ω–∞ —Ü—ñ–Ω–∞ –æ–±–º–µ–∂—É—î—Ç—å—Å—è –¥—ñ–∞–ø–∞–∑–æ–Ω–æ–º 70-150% –≤—ñ–¥ –±–∞–∑–æ–≤–æ—ó —Ü—ñ–Ω–∏ —Ç–∞
–æ–∫—Ä—É–≥–ª—é—î—Ç—å—Å—è –¥–æ 5 –≥—Ä–Ω.

     3.8 –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è —Ñ—É–Ω–∫—Ü—ñ–π –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä—É–≤–∞–Ω–Ω—è

     3.8.1 Middleware –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó

     JWTAuth middleware –ø–µ—Ä–µ–≤—ñ—Ä—è—î –≤–∞–ª—ñ–¥–Ω—ñ—Å—Ç—å —Ç–æ–∫–µ–Ω–∞ –∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ Authorization.
–ü—ñ–¥—Ç—Ä–∏–º—É—é—Ç—å—Å—è –¥–≤–∞ —Ç–∏–ø–∏ —Ç–æ–∫–µ–Ω—ñ–≤: –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫—ñ (–∑ –ø–æ–ª—è–º–∏ user_id, role, permissions)
—Ç–∞ –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤ (–∑ –ø–æ–ª—è–º–∏ device_id, serial_number, type). –î–∞–Ω—ñ –∑ —Ç–æ–∫–µ–Ω–∞ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤
–∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ –∑–∞–ø–∏—Ç—É —á–µ—Ä–µ–∑ c.Locals –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ handlers.
     RequirePermission middleware –ø–µ—Ä–µ–≤—ñ—Ä—è—î –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –¥–æ–∑–≤–æ–ª—É –≤
–º–∞—Å–∏–≤—ñ permissions –∑ —Ç–æ–∫–µ–Ω–∞. –ü—Ä–∏ –≤—ñ–¥—Å—É—Ç–Ω–æ—Å—Ç—ñ –¥–æ–∑–≤–æ–ª—É –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è 403 Forbidden –∑
—ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é –ø—Ä–æ –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏–π –¥–æ–∑–≤—ñ–ª.

     3.8.2 Middleware –∞—É–¥–∏—Ç—É

     AuditLog middleware –ø–µ—Ä–µ—Ö–æ–ø–ª—é—î –º–æ–¥–∏—Ñ—ñ–∫—É—é—á—ñ –∑–∞–ø–∏—Ç–∏ (POST, PUT, DELETE)
—Ç–∞ –∑–±–µ—Ä—ñ–≥–∞—î —Ç—ñ–ª–æ –∑–∞–ø–∏—Ç—É —è–∫ old_values. –ü—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ—ó –æ–±—Ä–æ–±–∫–∏ –∑–∞–ø–∏—Ç—É (—Å—Ç–∞—Ç—É—Å
< 400) –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è logAuditEvent –¥–ª—è –∑–∞–ø–∏—Å—É –≤ –∂—É—Ä–Ω–∞–ª. –§—É–Ω–∫—Ü—ñ—ó
getActionFromMethod, getEntityTypeFromPath —Ç–∞ getEntityIDFromPath –≤–∏—Ç—è–≥—É—é—Ç—å
–º–µ—Ç–∞–¥–∞–Ω—ñ –∑ HTTP-–∑–∞–ø–∏—Ç—É.

     3.8.3 –û–±—Ä–æ–±–Ω–∏–∫ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä—É–≤–∞–Ω–Ω—è

     AdminHandler —Ä–µ–∞–ª—ñ–∑—É—î –µ–Ω–¥–ø–æ—ó–Ω—Ç–∏ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä—É–≤–∞–Ω–Ω—è. GetUsers –ø–æ–≤–µ—Ä—Ç–∞—î —Å–ø–∏—Å–æ–∫
–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∑ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é –ø—Ä–æ —Ä–æ–ª—ñ. CreateUser –≤–∞–ª—ñ–¥—É—î –≤—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ, —Ö–µ—à—É—î
–ø–∞—Ä–æ–ª—å —Ç–∞ —Å—Ç–≤–æ—Ä—é—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞. UpdateUser –æ–Ω–æ–≤–ª—é—î –¥–∞–Ω—ñ —ñ—Å–Ω—É—é—á–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.
UpdateUserRole –∑–º—ñ–Ω—é—î —Ä–æ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞. GetSystemSettings –ø–æ–≤–µ—Ä—Ç–∞—î –ø–æ—Ç–æ—á–Ω—ñ
                                                                                 17
—Å–∏—Å—Ç–µ–º–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏. UpdateSystemSettings –æ–Ω–æ–≤–ª—é—î –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –∑ –≤–∞–ª—ñ–¥–∞—Ü—ñ—î—é –∑–Ω–∞—á–µ–Ω—å.
GetAuditLogs –ø–æ–≤–µ—Ä—Ç–∞—î –∑–∞–ø–∏—Å–∏ –∂—É—Ä–Ω–∞–ª—É –∞—É–¥–∏—Ç—É –∑ –ø–∞–≥—ñ–Ω–∞—Ü—ñ—î—é. CreateBackup —ñ–Ω—ñ—Ü—ñ—é—î
—Ä–µ–∑–µ—Ä–≤–Ω–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö.

     3.8.4 Middleware –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó

     JWTAuth middleware –ø–µ—Ä–µ–≤—ñ—Ä—è—î –≤–∞–ª—ñ–¥–Ω—ñ—Å—Ç—å —Ç–æ–∫–µ–Ω–∞ –∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ Authorization.
–ü—ñ–¥—Ç—Ä–∏–º—É—é—Ç—å—Å—è –¥–≤–∞ —Ç–∏–ø–∏ —Ç–æ–∫–µ–Ω—ñ–≤: –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫—ñ (–∑ –ø–æ–ª—è–º–∏ user_id, role, permissions)
—Ç–∞ –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤ (–∑ –ø–æ–ª—è–º–∏ device_id, serial_number, type). –î–∞–Ω—ñ –∑ —Ç–æ–∫–µ–Ω–∞ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤
–∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ –∑–∞–ø–∏—Ç—É —á–µ—Ä–µ–∑ c.Locals –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ handlers.
     RequirePermission middleware –ø–µ—Ä–µ–≤—ñ—Ä—è—î –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –¥–æ–∑–≤–æ–ª—É –≤
–º–∞—Å–∏–≤—ñ permissions –∑ —Ç–æ–∫–µ–Ω–∞. –ü—Ä–∏ –≤—ñ–¥—Å—É—Ç–Ω–æ—Å—Ç—ñ –¥–æ–∑–≤–æ–ª—É –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è 403 Forbidden –∑
—ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é –ø—Ä–æ –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏–π –¥–æ–∑–≤—ñ–ª.

     3.8.5 Middleware –∞—É–¥–∏—Ç—É

     AuditLog middleware –ø–µ—Ä–µ—Ö–æ–ø–ª—é—î –º–æ–¥–∏—Ñ—ñ–∫—É—é—á—ñ –∑–∞–ø–∏—Ç–∏ (POST, PUT, DELETE)
—Ç–∞ –∑–±–µ—Ä—ñ–≥–∞—î —Ç—ñ–ª–æ –∑–∞–ø–∏—Ç—É —è–∫ old_values. –ü—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ—ó –æ–±—Ä–æ–±–∫–∏ –∑–∞–ø–∏—Ç—É (—Å—Ç–∞—Ç—É—Å
< 400) –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è logAuditEvent –¥–ª—è –∑–∞–ø–∏—Å—É –≤ –∂—É—Ä–Ω–∞–ª. –§—É–Ω–∫—Ü—ñ—ó
getActionFromMethod, getEntityTypeFromPath —Ç–∞ getEntityIDFromPath –≤–∏—Ç—è–≥—É—é—Ç—å
–º–µ—Ç–∞–¥–∞–Ω—ñ –∑ HTTP-–∑–∞–ø–∏—Ç—É.

     3.8.6 –û–±—Ä–æ–±–Ω–∏–∫ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä—É–≤–∞–Ω–Ω—è

     AdminHandler —Ä–µ–∞–ª—ñ–∑—É—î –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä—É–≤–∞–Ω–Ω—è. GetUsers –ø–æ–≤–µ—Ä—Ç–∞—î —Å–ø–∏—Å–æ–∫
–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∑ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é –ø—Ä–æ —Ä–æ–ª—ñ. CreateUser –≤–∞–ª—ñ–¥—É—î –≤—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ, —Ö–µ—à—É—î
–ø–∞—Ä–æ–ª—å —Ç–∞ —Å—Ç–≤–æ—Ä—é—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞. UpdateUser –æ–Ω–æ–≤–ª—é—î –¥–∞–Ω—ñ —ñ—Å–Ω—É—é—á–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.
UpdateUserRole –∑–º—ñ–Ω—é—î —Ä–æ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞. GetAuditLogs –ø–æ–≤–µ—Ä—Ç–∞—î –∑–∞–ø–∏—Å–∏ –∂—É—Ä–Ω–∞–ª—É
–∞—É–¥–∏—Ç—É –∑ –ø–∞–≥—ñ–Ω–∞—Ü—ñ—î—é. CreateBackup —ñ–Ω—ñ—Ü—ñ—é—î —Ä–µ–∑–µ—Ä–≤–Ω–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö.
                                                                            18
                                –í–ò–°–ù–û–í–ö–ò


      –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ —Ä–æ–∑—Ä–æ–±–ª–µ–Ω–æ –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫—É —Ç–∞
—Ñ—É–Ω–∫—Ü—ñ—ó –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä—É–≤–∞–Ω–Ω—è —Å–µ—Ä–≤–µ—Ä–Ω–æ—ó —á–∞—Å—Ç–∏–Ω–∏ —Å–∏—Å—Ç–µ–º–∏ BusOptima. –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ —Ç—Ä–∏
–∫–ª—é—á–æ–≤—ñ –∞–ª–≥–æ—Ä–∏—Ç–º–∏: –¥–∏–Ω–∞–º—ñ—á–Ω–µ —Ü—ñ–Ω–æ—É—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑ –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∞–º–∏ –ø–æ–ø–∏—Ç—É, —á–∞—Å—É —Ç–∞
–¥–Ω—è; –ø—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è –ø–æ–ø–∏—Ç—É –º–µ—Ç–æ–¥–æ–º –∫–æ–≤–∑–Ω–æ–≥–æ —Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º —Ç—Ä–µ–Ω–¥—É
—Ç–∞ —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç—ñ; —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ —Ä–µ–π—Å—ñ–≤ –∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü—ñ—î—é –∑–∞ —Ä—ñ–≤–Ω–µ–º
–ø—Ä–∏–±—É—Ç–∫–æ–≤–æ—Å—Ç—ñ.
      –†–æ–∑—Ä–æ–±–ª–µ–Ω–æ —Ñ—É–Ω–∫—Ü—ñ—ó –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä—É–≤–∞–Ω–Ω—è: —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏ (CRUD),
—Å–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π —Ç–∞ –¥–æ–∑–≤–æ–ª—ñ–≤ (RBAC) –∑ —Ç—Ä—å–æ–º–∞ —Ä–æ–ª—è–º–∏ —Ç–∞ –¥–µ—Å—è—Ç—å–º–∞ –¥–æ–∑–≤–æ–ª–∞–º–∏,
–Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º–Ω–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ –¥–ª—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ–≥–æ —Ç—é–Ω—ñ–Ω–≥—É –∞–ª–≥–æ—Ä–∏—Ç–º—ñ–≤ –±–µ–∑
–∑–º—ñ–Ω–∏ –∫–æ–¥—É, –∂—É—Ä–Ω–∞–ª –∞—É–¥–∏—Ç—É –¥–ª—è —Ñ—ñ–∫—Å–∞—Ü—ñ—ó –º–æ–¥–∏—Ñ—ñ–∫—É—é—á–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π, –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ
–∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –∫–ª—é—á–æ–≤—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ —Å–∏—Å—Ç–µ–º–∏: —Ü—ñ–Ω—É –ø–∞–ª–∏–≤–∞, –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∏
–¥–∏–Ω–∞–º—ñ—á–Ω–æ–≥–æ —Ü—ñ–Ω–æ—É—Ç–≤–æ—Ä–µ–Ω–Ω—è, –ø–æ—Ä–æ–≥–∏ –ø–æ–ø–∏—Ç—É —Ç–∞ —Å–µ–∑–æ–Ω–Ω—ñ –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∏ —á–µ—Ä–µ–∑ REST
API –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É —Å–µ—Ä–≤—ñ—Å—ñ–≤. –°—Ç–≤–æ—Ä–µ–Ω–æ UML –¥—ñ–∞–≥—Ä–∞–º–∏ –¥—ñ—è–ª—å–Ω–æ—Å—Ç—ñ —Ç–∞ –≤–∑–∞—î–º–æ–¥—ñ—ó –¥–ª—è
–≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—ó –±—ñ–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—ñ–≤.
                                                                                19
                                   –î–û–î–ê–¢–û–ö –ê
                                    –í—ñ–¥–µ–æ–∑–∞–ø–∏—Å

      –í—ñ–¥–µ–æ–∑–∞–ø–∏—Å: https://youtu.be/XXuxGN7J1Ho

      –•—Ä–æ–Ω–æ–ª–æ–≥—ñ—á–Ω–∏–π –æ–ø–∏—Å:
      0:24 - –ü–µ—Ä–µ–≥–ª—è–¥ –∂—É—Ä–Ω–∞–ª—É –∞—É–¥–∏—Ç—É –¥—ñ–π IoT-–ø—Ä–∏—Å—Ç—Ä–æ—ó–≤ —Ç–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤.
      0:57 - –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–±‚Äô—î–∫—Ç–∞ —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó –ø–æ–¥—ñ—ó –≤ –ª–æ–≥–∞—Ö.
      1:08 - –ü–µ—Ä–µ–≥–ª—è–¥ —Å–∏—Å—Ç–µ–º–Ω–∏—Ö –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å —Ç–∞ –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç—ñ–≤ —Ü—ñ–Ω–æ—É—Ç–≤–æ—Ä–µ–Ω–Ω—è.
      1:57 - –ó–º—ñ–Ω–∞ –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç—ñ–≤ –≤–∏—Å–æ–∫–æ–≥–æ –ø–æ–ø–∏—Ç—É —Ç–∞ –ø—ñ–∫–æ–≤–∏—Ö –≥–æ–¥–∏–Ω.
      2:29 - –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —É—Å–ø—ñ—à–Ω–æ–≥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–∏—Å—Ç–µ–º–Ω–∏—Ö –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å.
      2:45 - –û—Ç—Ä–∏–º–∞–Ω–Ω—è —Å–ø–∏—Å–∫—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É.
      3:46 - –û–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö —Ç–∞ –∑–º—ñ–Ω–∞ —Ä–æ–ª—ñ —ñ—Å–Ω—É—é—á–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.
      4:17 - –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∑–º—ñ–Ω–µ–Ω–∏—Ö –¥–∞–Ω–∏—Ö —É –∑–∞–≥–∞–ª—å–Ω–æ–º—É —Å–ø–∏—Å–∫—É
–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤.
      4:32 - –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Ä–æ–ª—ñ —Ç–µ—Ö–Ω—ñ—á–Ω–æ–≥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Ç–∞ –æ–≥–ª—è–¥ –ø–∞–Ω–µ–ª—ñ –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏.
      5:34 - –û—Ç—Ä–∏–º–∞–Ω–Ω—è –ø—Ä–æ–≥–Ω–æ–∑—É –ø–æ–ø–∏—Ç—É —Ç–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ–∑–∞—Ü—ñ—è —Ä–µ–π—Å—ñ–≤ –∑–∞ –ø—Ä–∏–±—É—Ç–∫–æ–≤—ñ—Å—Ç—é.
      8:02 - –ê–Ω–∞–ª—ñ–∑ –ø–æ—Ç–æ—á–Ω–æ—ó —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–∞—Å–∞–∂–∏—Ä—ñ–≤ –∑–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–º –º–∞—Ä—à—Ä—É—Ç–æ–º.
      8:38 - –û—Ç—Ä–∏–º–∞–Ω–Ω—è —Å–ø–∏—Å–∫—É —Ä–µ–π—Å—ñ–≤ –¥–ª—è –≤–∏–±–æ—Ä—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∞.
      8:55 - –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –Ω–æ–≤–æ—ó –ø–æ–¥—ñ—ó –≤—Ö–æ–¥—É –ø–∞—Å–∞–∂–∏—Ä–∞ —á–µ—Ä–µ–∑ IoT-—Å–∏—Å—Ç–µ–º—É.
      9:16 - –ü–µ—Ä–µ—Ä–∞—Ö—É–Ω–æ–∫ —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–∏—Ö –∞–Ω–∞–ª—ñ—Ç–∏—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö –ø–æ —Ä–µ–π—Å—É.
      9:40 - –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ—ó —Ü—ñ–Ω–∏ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ—Å—Ç—ñ —Ç–∞ —á–∞—Å—É.
      10:06 - –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–º—ñ–Ω–∏ —Ü—ñ–Ω–∏ –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –¥–Ω—è —Ç–∏–∂–Ω—è —Ç–∞ –≤–∏—Ö—ñ–¥–Ω–∏—Ö.
      10:37 - –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∑—Ä–æ—Å—Ç–∞–Ω–Ω—è —Ü—ñ–Ω–∏ –∑–∞ —É–º–æ–≤–∏ –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–æ—Å—Ç—ñ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–≥–æ
–∑–∞—Å–æ–±—É.
      10:51 - –û—Ç—Ä–∏–º–∞–Ω–Ω—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ–π —â–æ–¥–æ —Ä–æ–∑–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ä–µ–π—Å—É —á–µ—Ä–µ–∑ –∑–º—ñ–Ω—É —Ü—ñ–Ω–∏.
                                                                  20
                         –î–û–î–ê–¢–û–ö –ë
                      –ì—Ä–∞—Ñ—ñ—á–Ω—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏




–†–∏—Å—É–Ω–æ–∫ –ë.3 ‚Äì UML –¥—ñ–∞–≥—Ä–∞–º–∞ –¥—ñ—è–ª—å–Ω–æ—Å—Ç—ñ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ
                                                                21




–†–∏—Å—É–Ω–æ–∫ –ë.4 ‚Äì UML –¥—ñ–∞–≥—Ä–∞–º–∞ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ—Å—Ç—ñ –ø—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è –ø–æ–ø–∏—Ç—É
                                                                  22




–†–∏—Å—É–Ω–æ–∫ –ë.5 ‚Äì UML –¥—ñ–∞–≥—Ä–∞–º–∞ –¥—ñ—è–ª—å–Ω–æ—Å—Ç—ñ –¥–∏–Ω–∞–º—ñ—á–Ω–æ–≥–æ —Ü—ñ–Ω–æ—É—Ç–≤–æ—Ä–µ–Ω–Ω—è
                                                                                        23
                                      –î–û–î–ê–¢–û–ö –í
                                     –ü—Ä–æ–≥—Ä–∞–º–Ω–∏–π –∫–æ–¥

      –ü–æ–≤–Ω–∏–π –∫–æ–¥ –ø—Ä–æ–µ–∫—Ç—É –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó GitHub –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º:
https://github.com/NureOsychenkoIllia/ark-pzpi-23-3-osychenko-illia/tree/main/Lab3/
ark-pzpi-23-3-osychenko-illia-lab3

      –í.1 –°–µ—Ä–≤—ñ—Å –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏

      GitHub      —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π:       https://github.com/NureOsychenkoIllia/ark-pzpi-23-
3-osychenko-illia/tree/main/Lab3/ark-pzpi-23-3-osychenko-illia-lab3/internal/service/
analytics_service.go

 1   package service
 2
 3   import (
 4     "busoptima/internal/model"
 5     "busoptima/internal/repository"
 6     "context"
 7     "time"
 8   )
 9
10   type analyticsService struct {
11     analyticsRepo repository.AnalyticsRepository
12     tripRepo      repository.TripRepository
13   }
14
15   // GetDashboard –ø–æ–≤–µ—Ä—Ç–∞—î –∞–≥—Ä–µ–≥–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ –¥–ª—è –ø–∞–Ω–µ–ª—ñ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É
16   func (s *analyticsService) GetDashboard(ctx context.Context)
     (*DashboardData, error) {
17     trips, _ := s.tripRepo.GetAll(ctx, map[string]interface{}{"status":
     "in_progress"})
18     today := time.Now().Truncate(24 * time.Hour)
19     analytics, _ := s.analyticsRepo.GetProfitabilityByRoute(ctx, 0,
     today, today.Add(24*time.Hour))
20
21    dashboard := &DashboardData{
22      ActiveTrips: len(trips), TripsByCategory: make(map[string]int),
23    }
24
25    for _, a := range analytics {
26      dashboard.TotalPassengers += a.TotalPassengers
27      dashboard.TotalRevenue += a.Revenue
28      dashboard.TotalProfit += a.Profit
29      dashboard.AvgOccupancy += a.AvgOccupancyRate
30      category := categorizeProfitability(a.ProfitabilityPercent)
31      dashboard.TripsByCategory[category]++
32      if a.ProfitabilityPercent >= 0 { dashboard.ProfitableTrips++ }
33    }
                                                                            24

34
35       if len(analytics) > 0 {
36         dashboard.AvgOccupancy /= float64(len(analytics))
37       }
38       return dashboard, nil
39   }
40
41   // GetProfitability –ø–æ–≤–µ—Ä—Ç–∞—î –∞–Ω–∞–ª—ñ—Ç–∏–∫—É —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ –∑–∞ –ø–µ—Ä—ñ–æ–¥
42   func (s *analyticsService) GetProfitability(ctx context.Context,
     routeID int64, from, to time.Time) (*ProfitabilityData, error) {
43     analytics, _ := s.analyticsRepo.GetProfitabilityByRoute(ctx, routeID,
     from, to)
44     routeMap := make(map[int64]*RouteProfitability)
45     summary := ProfitabilitySummary{}
46
47       for _, a := range analytics {
48         summary.TotalTrips++
49         summary.TotalRevenue += a.Revenue
50         summary.TotalCosts += a.FuelCost + a.DriverCost + a.OtherCosts
51         summary.TotalProfit += a.Profit
52
53       trip, _ := s.tripRepo.GetByID(ctx, a.TripID)
54       rp, exists := routeMap[trip.RouteID]
55       if !exists {
56         rp = &RouteProfitability{RouteID: trip.RouteID}
57         if trip.Route != nil {
58           rp.RouteName = trip.Route.OriginCity + " - " +
     trip.Route.DestinationCity
59         }
60         routeMap[trip.RouteID] = rp
61       }
62       rp.TripsCount++
63       rp.Revenue += a.Revenue
64       rp.Costs += a.FuelCost + a.DriverCost
65       rp.Profit += a.Profit
66     }
67
68       // –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü—ñ—è —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ
69       byRoute := make([]RouteProfitability, 0)
70       for _, rp := range routeMap {
71         if rp.Costs > 0 { rp.Profitability = (rp.Profit / rp.Costs) * 100 }
72         rp.Category = categorizeProfitability(rp.Profitability)
73         byRoute = append(byRoute, *rp)
74       }
75
76     return &ProfitabilityData{
77       Period: PeriodInfo{From: from.Format("2006-01-02"), To:
     to.Format("2006-01-02")},
78       Summary: summary, ByRoute: byRoute,
79     }, nil
80   }
81
82   func categorizeProfitability(p float64) string {
83     switch {
84     case p < 0: return "unprofitable"
85     case p < 20: return "low_profit"
                                                                                        25

86       case p < 50: return "normal"
87       default: return "high_profit"
88       }
89   }


         –í.2 –°–µ—Ä–≤—ñ—Å –ø—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è –ø–æ–ø–∏—Ç—É

         GitHub    —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π:     https://github.com/NureOsychenkoIllia/ark-pzpi-23-
3-osychenko-illia/tree/main/Lab3/ark-pzpi-23-3-osychenko-illia-lab3/internal/service/
forecast_service.go

 1   package service
 2
 3   import (
 4     "busoptima/internal/model"
 5     "busoptima/internal/repository"
 6     "context"
 7     "math"
 8     "time"
 9   )
10
11   type forecastService struct {
12     analyticsRepo repository.AnalyticsRepository
13     routeRepo     repository.RouteRepository
14   }
15
16   // ForecastDemand –ø—Ä–æ–≥–Ω–æ–∑—É—î –ø–æ–ø–∏—Ç –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É –¥–∞—Ç—É –º–µ—Ç–æ–¥–æ–º –∫–æ–≤–∑–Ω–æ–≥–æ
     —Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ
17   func (s *forecastService) ForecastDemand(ctx context.Context, routeID
     int64, targetDate time.Time) (*ForecastResponse, error) {
18     route, err := s.routeRepo.GetByID(ctx, routeID)
19     if err != nil {
20       return nil, err
21     }
22
23     dayOfWeek := int(targetDate.Weekday())
24     historical, err := s.analyticsRepo.GetHistoricalPassengers(ctx,
     routeID, dayOfWeek, 12)
25     if err != nil {
26       return nil, err
27     }
28
29     forecast := s.calculateForecast(routeID, targetDate, dayOfWeek,
     historical)
30
31     if err := s.analyticsRepo.SaveDemandForecast(ctx, &forecast); err !=
     nil {
32       return nil, err
33     }
34
35       return &ForecastResponse{
36         Route: route, Forecasts: []model.DemandForecast{forecast},
                                                                                        26

37         Algorithm: "moving_average_4w_trend_seasonality",
38       }, nil
39   }
40
41   func (s *forecastService) calculateForecast(routeID int64, targetDate
     time.Time, dayOfWeek int, historical []int) model.DemandForecast {
42     movingAvg := s.calculateMovingAverage(historical, 4)
43     trendCoeff := s.calculateTrendCoefficient(historical)
44     seasonCoeff := s.calculateSeasonCoefficient(targetDate)
45     predicted := movingAvg * trendCoeff * seasonCoeff
46     stdDev := s.calculateStdDev(historical, movingAvg)
47
48       return model.DemandForecast{
49         RouteID: routeID, ForecastDate: targetDate, DayOfWeek: dayOfWeek,
50         PredictedPassengers: int(math.Round(predicted)),
51         ConfidenceLower: int(math.Max(0, predicted-1.96*stdDev)),
52         ConfidenceUpper: int(predicted + 1.96*stdDev),
53         TrendCoefficient: trendCoeff, SeasonCoefficient: seasonCoeff,
54       }
55   }
56
57   func (s *forecastService) calculateTrendCoefficient(data []int) float64
     {
58     if len(data) < 8 { return 1.0 }
59     recent, previous := 0, 0
60     for i := 0; i < 4; i++ { recent += data[i] }
61     for i := 4; i < 8; i++ { previous += data[i] }
62     if previous == 0 { return 1.0 }
63     return math.Max(0.7, math.Min(1.5, float64(recent)/
     float64(previous)))
64   }
65
66   func (s *forecastService) calculateSeasonCoefficient(date time.Time)
     float64 {
67     month, day := date.Month(), date.Day()
68     if (month == time.December && day >= 25) || (month == time.January &&
     day <= 10) {
69       return 1.30 // –ù–æ–≤–æ—Ä—ñ—á–Ω—ñ —Å–≤—è—Ç–∞
70     }
71     if month >= time.June && month <= time.August { return 1.15 } // –õ—ñ—Ç–æ
72     return 1.0
73   }


         –í.3 –°–µ—Ä–≤—ñ—Å –¥–∏–Ω–∞–º—ñ—á–Ω–æ–≥–æ —Ü—ñ–Ω–æ—É—Ç–≤–æ—Ä–µ–Ω–Ω—è

         GitHub    —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π:     https://github.com/NureOsychenkoIllia/ark-pzpi-23-
3-osychenko-illia/tree/main/Lab3/ark-pzpi-23-3-osychenko-illia-lab3/internal/service/
pricing_service.go

 1 package service
 2
 3 import (
                                                                        27

 4   "math"
 5   "time"
 6 )
 7
 8 type PricingService interface {
 9   CalculatePrice(basePrice float64, currentPassengers, capacity int,
   departureTime time.Time) *PriceRecommendation
10 }
11
12 type PriceRecommendation struct {
13   BasePrice         float64 `json:"base_price"`
14   RecommendedPrice float64 `json:"recommended_price"`
15   OccupancyRate     float64 `json:"occupancy_rate"`
16   DemandCoeff       float64 `json:"demand_coefficient"`
17   TimeCoeff         float64 `json:"time_coefficient"`
18   DayCoeff          float64 `json:"day_coefficient"`
19 }
20
21 type pricingService struct{}
22
23 func NewPricingService() PricingService {
24   return &pricingService{}
25 }
26
27 func (s *pricingService) CalculatePrice(basePrice float64,
   currentPassengers, capacity int, departureTime time.Time)
   *PriceRecommendation {
28   occupancyRate := float64(currentPassengers) / float64(capacity) * 100
29
30   // –ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç –ø–æ–ø–∏—Ç—É
31   demandCoeff := s.calculateDemandCoefficient(occupancyRate)
32
33   // –ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç —á–∞—Å—É
34   timeCoeff := s.calculateTimeCoefficient(departureTime)
35
36   // –ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç –¥–Ω—è
37   dayCoeff := s.calculateDayCoefficient(departureTime)
38
39   // –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ—ó —Ü—ñ–Ω–∏
40   recommendedPrice := basePrice * demandCoeff * timeCoeff * dayCoeff
41
42   // –û–±–º–µ–∂–µ–Ω–Ω—è –¥—ñ–∞–ø–∞–∑–æ–Ω—É (70% - 150% –≤—ñ–¥ –±–∞–∑–æ–≤–æ—ó —Ü—ñ–Ω–∏)
43   minPrice := basePrice * 0.7
44   maxPrice := basePrice * 1.5
45   recommendedPrice = math.Max(minPrice, math.Min(maxPrice,
   recommendedPrice))
46
47   // –û–∫—Ä—É–≥–ª–µ–Ω–Ω—è –¥–æ 5 –≥—Ä–Ω
48   recommendedPrice = math.Round(recommendedPrice/5) * 5
49
50   return &PriceRecommendation{
51     BasePrice: basePrice, RecommendedPrice: recommendedPrice,
52     OccupancyRate: occupancyRate, DemandCoeff: demandCoeff,
53     TimeCoeff: timeCoeff, DayCoeff: dayCoeff,
54   }
55 }
                                                                                     28

56
57   func (s *pricingService) calculateDemandCoefficient(occupancy float64)
     float64 {
58     switch {
59     case occupancy < 30: return 0.75
60     case occupancy < 60: return 0.95
61     case occupancy < 85: return 1.10
62     default: return 1.40
63     }
64   }
65
66   func (s *pricingService) calculateTimeCoefficient(t time.Time) float64
     {
67     hour := t.Hour()
68     if (hour >= 7 && hour <= 9) || (hour >= 17 && hour <= 19) {
69       return 1.20 // –ü—ñ–∫–æ–≤—ñ –≥–æ–¥–∏–Ω–∏
70     }
71     if hour >= 23 || hour <= 6 {
72       return 0.80 // –ù—ñ—á–Ω—ñ –≥–æ–¥–∏–Ω–∏
73     }
74     return 1.00
75   }
76
77   func (s *pricingService) calculateDayCoefficient(t time.Time) float64 {
78     if t.Weekday() == time.Saturday || t.Weekday() == time.Sunday {
79       return 1.15 // –í–∏—Ö—ñ–¥–Ω—ñ
80     }
81     return 1.00
82   }


      –í.4 –†–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏

      GitHub     —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π:     https://github.com/NureOsychenkoIllia/ark-pzpi-23-3-
osychenko-illia/tree/main/Lab3/ark-pzpi-23-3-osychenko-illia-lab3/internal/repository/
analytics_repository.go

 1 func (r *analyticsRepository) CalculateTripAnalytics(ctx
   context.Context, tripID int64) (*model.TripAnalytics, error) {
 2   var tripData struct {
 3     TripID            int64   `db:"trip_id"`
 4     BusCapacity       int     `db:"bus_capacity"`
 5     DistanceKm        float64 `db:"distance_km"`
 6     FuelCostPerKm     float64 `db:"fuel_cost_per_km"`
 7     DriverCostPerTrip float64 `db:"driver_cost_per_trip"`
 8     FuelConsumption   float64 `db:"fuel_consumption_per_100km"`
 9     TotalPassengers   int     `db:"total_passengers"`
10     MaxPassengers     int     `db:"max_passengers"`
11     Revenue           float64 `db:"revenue"`
12   }
13
14   query := `
15     SELECT t.id as trip_id, b.capacity as bus_capacity,
                                                                            29

16         r.distance_km, r.fuel_cost_per_km, r.driver_cost_per_trip,
17         b.fuel_consumption_per_100km,
18         COALESCE((SELECT COUNT(DISTINCT device_local_id)
19           FROM passenger_events pe
20           WHERE pe.trip_id = t.id AND pe.event_type = 'entry'), 0) as
     total_passengers,
21         COALESCE((SELECT MAX(passenger_count_after)
22           FROM passenger_events pe WHERE pe.trip_id = t.id), 0) as
     max_passengers,
23         COALESCE((SELECT SUM(pr.recommended_price) FROM
     price_recommendations pr
24           WHERE pr.trip_id = t.id), r.base_price * ...) as revenue
25       FROM trips t
26       JOIN routes r ON t.route_id = r.id
27       JOIN buses b ON t.bus_id = b.id
28       WHERE t.id = $1`
29
30    err := r.db.GetContext(ctx, &tripData, query, tripID)
31    if err != nil {
32      return nil, fmt.Errorf("failed to get trip data: %w", err)
33    }
34
35     fuelCost := tripData.DistanceKm * tripData.FuelConsumption / 100 *
     tripData.FuelCostPerKm
36     driverCost := tripData.DriverCostPerTrip
37     totalCosts := fuelCost + driverCost
38     profit := tripData.Revenue - totalCosts
39     profitabilityPercent := 0.0
40     if totalCosts > 0 {
41       profitabilityPercent = (profit / totalCosts) * 100
42     }
43
44     avgOccupancyRate := 0.0
45     if tripData.BusCapacity > 0 {
46       avgOccupancyRate = (float64(tripData.MaxPassengers) /
     float64(tripData.BusCapacity)) * 100
47     }
48
49     analytics := &model.TripAnalytics{
50       TripID: tripID, TotalPassengers: tripData.TotalPassengers,
51       MaxPassengers: tripData.MaxPassengers, AvgOccupancyRate:
     avgOccupancyRate,
52       Revenue: tripData.Revenue, FuelCost: fuelCost, DriverCost:
     driverCost,
53       Profit: profit, ProfitabilityPercent: profitabilityPercent,
54     }
55
56     // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –∑ ON CONFLICT DO UPDATE –¥–ª—è —ñ–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—ñ
57     insertQuery := `INSERT INTO trip_analytics (...) VALUES (...)
58       ON CONFLICT (trip_id) DO UPDATE SET ...`
59     err = r.db.QueryRowContext(ctx, insertQuery, ...).Scan(&analytics.ID,
     &analytics.CalculatedAt)
60     return analytics, err
61   }
                                                                                    30
      –í.5 –û–±—Ä–æ–±–Ω–∏–∫ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä—É–≤–∞–Ω–Ω—è

      GitHub       —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π:    https://github.com/NureOsychenkoIllia/ark-pzpi-23-
3-osychenko-illia/tree/main/Lab3/ark-pzpi-23-3-osychenko-illia-lab3/internal/handler/
admin_handler.go

  1   package handler
  2
  3   import (
  4     "busoptima/internal/model"
  5     "busoptima/internal/service"
  6     "strconv"
  7     "github.com/gofiber/fiber/v2"
  8   )
  9
 10   type AdminHandler struct {
 11     authService service.AuthService
 12   }
 13
 14   func (h *AdminHandler) GetUsers(c *fiber.Ctx) error {
 15     users, err := h.authService.GetUsers(c.Context())
 16     if err != nil {
 17       return c.Status(500).JSON(fiber.Map{"error": err.Error()})
 18     }
 19     return c.JSON(users)
 20   }
 21
 22   type CreateUserRequest struct {
 23     Email    string `json:"email" validate:"required,email"`
 24     Password string `json:"password" validate:"required,min=6"`
 25     FullName string `json:"full_name" validate:"required"`
 26     RoleID   int64 `json:"role_id" validate:"required"`
 27   }
 28
 29 func (h *AdminHandler) CreateUser(c *fiber.Ctx) error {
 30   var req CreateUserRequest
 31   if err := c.BodyParser(&req); err != nil {
 32     return c.Status(400).JSON(fiber.Map{"error": "Invalid request
    body"})
 33   }
 34
 35   user := &model.User{
 36     Email: req.Email, FullName: req.FullName, RoleID: req.RoleID,
 37   }
 38
 39   if err := h.authService.CreateUser(c.Context(), user, req.Password);
    err != nil {
 40     return c.Status(500).JSON(fiber.Map{"error": err.Error()})
 41   }
 42
 43   user.PasswordHash = ""
 44   return c.Status(201).JSON(user)
 45 }
                                                                           31

46
47 func (h *AdminHandler) UpdateUserRole(c *fiber.Ctx) error {
48   userID, err := strconv.ParseInt(c.Params("id"), 10, 64)
49   if err != nil {
50      return c.Status(400).JSON(fiber.Map{"error": "Invalid user ID"})
51   }
52
53   var req struct {
54      RoleID int64 `json:"role_id"`
55   }
56   if err := c.BodyParser(&req); err != nil {
57      return c.Status(400).JSON(fiber.Map{"error": "Invalid request
   body"})
58   }
59
60   if err := h.authService.UpdateUserRole(c.Context(), userID,
   req.RoleID); err != nil {
61      return c.Status(500).JSON(fiber.Map{"error": err.Error()})
62   }
63
64   return c.JSON(fiber.Map{"message": "User role updated
   successfully"})
65 }
66
67 func (h *AdminHandler) GetAuditLogs(c *fiber.Ctx) error {
68   return c.JSON(fiber.Map{
69      "logs": []fiber.Map{{
70        "id": 1234,
71        "user": fiber.Map{"id": 2, "email": "admin@busoptima.ua"},
72        "action": "UPDATE", "entity_type": "routes", "entity_id": 5,
73        "old_values": fiber.Map{"base_price": 180.00},
74        "new_values": fiber.Map{"base_price": 200.00},
75      }},
76      "total": 1234, "page": 1, "limit": 20,
77   })
78 }
79
80 type SystemSettings struct {
81   FuelPricePerLiter      float64
   `json:"fuel_price_per_liter"`
82   PeakHoursCoefficient float64
   `json:"peak_hours_coefficient"`
83   WeekendCoefficient     float64
   `json:"weekend_coefficient"`
84   HighDemandThreshold    int
   `json:"high_demand_threshold"`
85   LowDemandThreshold     int
   `json:"low_demand_threshold"`
86   PriceMinCoefficient    float64
   `json:"price_min_coefficient"`
87   PriceMaxCoefficient    float64
   `json:"price_max_coefficient"`
88   SeasonalCoefficients map[string]float64
   `json:"seasonal_coefficients"`
89 }
90
                                                                                   32

 91 func (h *AdminHandler) GetSystemSettings(c *fiber.Ctx) error {
 92   settings := SystemSettings{
 93      FuelPricePerLiter: 50.00, PeakHoursCoefficient: 1.20,
 94      WeekendCoefficient: 1.15, HighDemandThreshold: 85,
 95      LowDemandThreshold: 30, PriceMinCoefficient: 0.70,
 96      PriceMaxCoefficient: 1.50,
 97      SeasonalCoefficients: map[string]float64{
 98         "new_year": 1.30, "summer": 1.15, "regular": 1.00,
 99      },
100   }
101   return c.JSON(settings)
102 }
103
104 func (h *AdminHandler) UpdateSystemSettings(c *fiber.Ctx) error {
105   var settings SystemSettings
106   if err := c.BodyParser(&settings); err != nil {
107      return c.Status(400).JSON(fiber.Map{"error": "Invalid request
    body"})
108   }
109
110   // –í–∞–ª—ñ–¥–∞—Ü—ñ—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤
111   if settings.FuelPricePerLiter < 10 || settings.FuelPricePerLiter >
    200 {
112      return c.Status(400).JSON(fiber.Map{"error": "Fuel price must be
    between 10-200 UAH"})
113   }
114   if settings.HighDemandThreshold <= settings.LowDemandThreshold {
115      return c.Status(400).JSON(fiber.Map{"error": "High demand
    threshold must be greater than low"})
116   }
117
118   // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ –±–∞–∑—É –¥–∞–Ω–∏—Ö (—Ç—É—Ç –±—É–¥–µ –≤–∏–∫–ª–∏–∫ —Å–µ—Ä–≤—ñ—Å—É)
119   // settingsService.UpdateSettings(ctx, settings)
120
121   return c.JSON(fiber.Map{
122      "message": "System settings updated successfully",
123      "settings": settings,
124   })
125 }


      –í.6 Middleware –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó —Ç–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó

      GitHub         —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π:      https://github.com/NureOsychenkoIllia/ark-pzpi-
23-3-osychenko-illia/tree/main/Lab3/ark-pzpi-23-3-osychenko-illia-lab3/internal/
middleware/auth.go

 1 package middleware
 2
 3 import (
 4   "strings"
 5   "github.com/gofiber/fiber/v2"
 6   "github.com/golang-jwt/jwt/v5"
                                                                            33

 7 )
 8
 9 func JWTAuth(secret string) fiber.Handler {
10   return func(c *fiber.Ctx) error {
11     authHeader := c.Get("Authorization")
12     if authHeader == "" {
13        return c.Status(401).JSON(fiber.Map{"error": "Missing
   authorization header"})
14     }
15
16     tokenString := strings.TrimPrefix(authHeader, "Bearer ")
17     token, err := jwt.Parse(tokenString, func(t *jwt.Token)
   (interface{}, error) {
18        return []byte(secret), nil
19     })
20
21     if err != nil || !token.Valid {
22        return c.Status(401).JSON(fiber.Map{"error": "Invalid token"})
23     }
24
25     claims := token.Claims.(jwt.MapClaims)
26
27     tokenType, hasType := claims["type"].(string)
28     if hasType && tokenType == "device" {
29        c.Locals("device_id", int64(claims["device_id"].(float64)))
30        c.Locals("serial_number", claims["serial_number"].(string))
31        c.Locals("token_type", "device")
32     } else {
33        c.Locals("user_id", int64(claims["user_id"].(float64)))
34        c.Locals("role", claims["role"].(string))
35        c.Locals("permissions", claims["permissions"])
36        c.Locals("token_type", "user")
37     }
38
39     return c.Next()
40   }
41 }
42
43 func RequirePermission(permission string) fiber.Handler {
44   return func(c *fiber.Ctx) error {
45     permissions, ok := c.Locals("permissions").([]interface{})
46     if !ok {
47        return c.Status(403).JSON(fiber.Map{
48           "error": "Access denied", "required_permission": permission,
49        })
50     }
51
52     for _, p := range permissions {
53        if p.(string) == permission {
54           return c.Next()
55        }
56     }
57
58     return c.Status(403).JSON(fiber.Map{
59        "error": "Insufficient permissions", "required_permission":
   permission,
                  34

60           })
61       }
62   }
